var EnhC=class{constructor(i,s){this.uid=i,s&&(this.cid=s),this.vid="",this.type="ecommerce",this.cnv=!1,this.tr=0,this.org="https://collect.enhencer.com/api",this.message="No token. Contact Enhencer Integration Team at hello@enhencer.com",this.lsr,this.ic=0,this.epid="795653402096404",this.enh_last_access=0,this.isTimeValid=!0,this.isb,this.country,this.categories,this.isAnEnabled,this.isReady=!1,this.actions={l:0,p:0,c:0},this.hsa=this.hsa.bind(this)}init(){document.cookie&&null!==this.getCookie("enh_visitor_session")?this.vid=this.getCookie("enh_visitor_session"):(this.vid=this.#e(),this.setCookie("enh_visitor_session",this.vid,120),this.setCookie("enh_source",document.referrer,120)),null!==this.getCookie("enh_token")&&void 0===this.uid?this.uid=this.getCookie("enh_token"):null===this.getCookie("enh_token")&&void 0!==this.uid&&this.setCookie("enh_token",this.uid,120),null!==this.getCookie("enh_last_access")&&(this.enh_last_access=parseInt(this.getCookie("enh_last_access"))),this.setCookie("enh_last_access",(new Date).getTime(),120),(new Date).getTime()-this.enh_last_access<2e3&&(this.isTimeValid=!1);if(this.getCookie("enh_has_lsr")&&null!==localStorage.getItem("enh_lsr")){"[object Object]"!==localStorage.getItem("enh_lsr")&&(this.lsr=localStorage.getItem("enh_lsr"))}else localStorage.removeItem("enh_lsr"),this.lsr=null;this.hb(!0),this.hsa();let i=this;document.addEventListener("click",(function(s){i.cc(s.target)})),this.#t()}hsa(){if(!this.uid||!this.isTimeValid)return console.log(this.message),this.message;{let i=window.location.pathname,s=this;if(null!=window.ShopifyAnalytics)if("collection"===window.ShopifyAnalytics.meta.page.pageType){let o=i.replace("/collections/","");o=o.includes("?")?o.substring(0,o.indexOf("?")):o,"function"!=typeof s.listingPage?window.enhencer.listingPage(o):s.listingPage(o)}else if("page"===window.ShopifyAnalytics.meta.page.pageType){let o=i.replace("/","");o=o.includes("?")?o.substring(0,o.indexOf("?")):o,"function"!=typeof s.listingPage?window.enhencer.listingPage(o):s.listingPage(o)}else if("product"===window.ShopifyAnalytics.meta.page.pageType){let id=window.ShopifyAnalytics.meta.product.id,price=window.ShopifyAnalytics.meta.product.variants[0].price/100,o="";window.ShopifyAnalytics.meta.product.type?o=window.ShopifyAnalytics.meta.product.type:i.includes("collections")?o=i.substring(i.indexOf("/collections/")+13,i.indexOf("/products/")):document.referrer&&document.referrer.includes("collections")&&(o=document.referrer.replace(window.location.origin,"").replace("/collections/","")),window.ShopifyAnalytics.lib.config["Google Analytics"]&&window.ShopifyAnalytics.lib.config["Google Analytics"].enhancedEcommerce&&window.dataLayer&&window.dataLayer.forEach((i=>{"event"==i[0]&&"view_item"==i[1]&&(i[2].items[0].category&&(o=i[2].items[0].category),i[2].items[0].price&&(price=parseInt(i[2].items[0].price)),i[2].items[0].id&&(id=i[2].items[0].id))})),o=o.includes("?")?o.substring(0,o.indexOf("?")):o,"function"!=typeof s.productPage?window.enhencer.productPage({category:o,id:id,price:price}):s.productPage({category:o,id:id,price:price})}else i.includes("checkouts")&&i.includes("thank_you")&&("function"!=typeof s.conversion?window.enhencer.conversion():s.conversion());else s.tr<10&&(s.tr+=1,setTimeout((()=>s.hsa()),500))}}cc(i){let s=this;[i,i.parentElement,i.parentElement.parentElement].some((i=>(i=>["BUTTON","INPUT","A"].includes(i.nodeName))(i)&&(i=>i.outerHTML.toLowerCase().match(/(checkout|googlepay|paypal|shopifypay|applepay)/))(i)))&&("function"!=typeof s.conversion?window.enhencer.conversion():s.conversion()),null===i.closest("button")&&null===i.closest("input")&&null===i.closest("a")||s.hb(!1)}hb(i){let s=this;setTimeout((()=>{fetch(window.location.origin+"/cart.js").then((i=>{if(i.ok)return i.json();throw new Error("No cart data found.")})).then((o=>{let n=s.getCookie("enh_cart_ic")&&0!==s.getCookie("enh_cart_ic").length?parseInt(s.getCookie("enh_cart_ic")):0,a=o.item_count;(!i&&a>s.ic||i&&a>n)&&s.addedToBasket(),s.setCookie("enh_cart_ic",a,7),s.ic=a}))}),i?0:1500)}productPage(i){if(!this.uid||!this.isTimeValid)return console.log(this.message),this.message;if(this.#i("productPage",[i]))return;if(this.isb)return this.actions.p++,this.#s(),void this.#o();let deviceType=this.getDeviceType(),s=JSON.stringify({visitorID:this.vid,type:this.type,productID:i.id,productCategory2:i.category,price:parseInt(i.price),deviceType:deviceType,product_viewer:1,source:null===this.getCookie("enh_source")?"":this.getCookie("enh_source"),actionType:"product",userID:this.uid,id:this.vid});fetch(`${this.org}/products/`,{method:"POST",headers:{"Content-Type":"text/plain"},body:s}),this.scoreMe()}listingPage(i){if(!this.uid||!this.isTimeValid)return console.log(this.message),this.message;if(this.#i("listingPage",[i]))return;if(this.isb)return this.actions.l++,this.#s(),void this.#o();let deviceType=this.getDeviceType(),s=JSON.stringify({type:this.type,visitorID:this.vid,productCategory1:i,productCategory2:"",deviceType:deviceType,source:null===this.getCookie("enh_source")?"":this.getCookie("enh_source"),userID:this.uid,id:this.vid});fetch(`${this.org}/listings/`,{method:"POST",headers:{"Content-Type":"text/plain"},body:s}),this.scoreMe()}addedToBasket(){if(!this.uid||!this.isTimeValid)return console.log(this.message),this.message;if(this.#i("addedToBasket",[]))return;if(this.isb)return this.actions.c++,this.#s(),void this.#o();let id="no-id";void 0!==window.ShopifyAnalytics?.meta?.product?.id&&(id=window.ShopifyAnalytics.meta.product.id.toString());let i=JSON.stringify({type:this.type,visitorID:this.vid,productID:id,actionType:"basket",userID:this.uid,id:this.vid});fetch(`${this.org}/purchases/`,{method:"POST",headers:{"Content-Type":"text/plain"},body:i}),this.scoreMe()}conversion(){if(!this.uid||!this.isTimeValid)return console.log(this.message),this.message;if(!this.#i("conversion",[])){if(this.isb)return this.actions.c++,this.#s(),void this.#o();if(!this.cnv){this.cnv=!0;let basketID=Date.now().toString(),i=[{id:basketID,quantity:1,price:1}],s=JSON.stringify({visitorID:this.vid,type:this.type,basketID:basketID,products:i,actionType:"purchase",userID:this.uid,id:this.vid});fetch(`${this.org}/purchases/`,{method:"POST",headers:{"Content-Type":"text/plain"},body:s}),this.scoreMe()}}}scoreMe(){let i=this;if(i.lsr){let s=i.refreshEventIdsOfCachedResult(i.lsr);i.#n(s,!1),i.#a(s)}else{let s=JSON.stringify({type:i.type,visitorID:i.vid,deviceType:i.getDeviceType(),source:i.getCookie("enh_source")||"",userID:i.uid,id:i.vid,eventSourceUrl:window.location.href,fbp:i.getCookie("_fbp"),fbc:i.getCookie("_fbc")||"",userAgent:navigator.userAgent});fetch(`${i.org}/customers/${i.vid}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:s}).then((i=>{if(i.ok)return i.text();throw new Error("No segment info for this user.")})).then((s=>{i.#n(s,!0)})).catch((i=>{console.error("Error:",i)}))}}#n(i,s){let o="object"!=typeof i?JSON.parse(i):i;o.campaigns?.length&&s&&(localStorage.setItem("enh_lsr",i),this.setCookie("enh_has_lsr",1,3),this.lsr=o);let n=this;o.conversionId&&(this.cid=o.conversionId),n.#r(o),n.#c(o);let a=Date.now(),r=setInterval((function(){let i=Date.now();"undefined"!=typeof fbq&&(n.#h(o),clearInterval(r)),i-a>5e3&&clearInterval(r)}),500)}#a(i){let s=this,o=JSON.stringify({userId:s.uid,eventSourceUrl:window.location.href,fbp:s.getCookie("_fbp"),fbc:s.getCookie("_fbc")||"",userAgent:navigator.userAgent,savedScoreApiResponse:i});fetch(`${s.org}/customers/fbcapi/`,{method:"POST",headers:{"Content-Type":"text/plain"},body:o})}#d(){if(!this.isReady||!this.isAnEnabled)return;let i=Date.now(),s=setInterval((()=>{let o=Date.now();"undefined"!=typeof fbq&&(fbq("init",this.epid),fbq("trackCustom","enh_an",{enhencerCategories:this.categories,country:this.country}),clearInterval(s)),o-i>5e3&&clearInterval(s)}),500)}#h(i){"6390d02561190d0dcb3bf442"===this.uid&&fbq("init","926535874078391",{}),i.campaigns&&i.campaigns.forEach((i=>{if("Facebook"===i.adPlatform){let s={},o={};i.eventId&&(o.eventID=i.eventId),i.bundles&&i.bundles.length>0&&i.bundles.forEach((i=>{s[i.name]=i.value})),fbq("trackCustom",i.name,s,o)}}))}#c(i){let s={event:"enhencer.ready"},o={};this.cid&&(o.send_to="AW-"+this.cid,this.#l("page_view",o)),"undefined"!=typeof dataLayer&&dataLayer.push(s),this.cid&&i.campaigns&&i.campaigns.forEach((i=>{if("Google"===i.adPlatform){let s={};i.bundles&&i.bundles.length>0&&i.bundles.forEach((i=>{s[i.name]=i.value})),s.send_to="AW-"+this.cid,this.#l(i.name,s)}}))}#l(i,s){this.#g()?("undefined"==typeof gtag&&this.#u(),gtag("event",i,s)):(this.#p(),this.#u(),gtag("event",i,s))}#g(){let i=document.getElementsByTagName("script");for(var s=0;s<i.length;s++)if(i[s].src&&i[s].src.includes("www.googletagmanager.com/gtag/js"))return!0;return!1}#p(){let i=document.createElement("script");i.src="https://www.googletagmanager.com/gtag/js?id=AW-"+this.cid,document.getElementsByTagName("head")[0].appendChild(i),window.dataLayer=window.dataLayer||[]}#u(){function gtag(){dataLayer.push(arguments)}window.gtag=gtag,gtag("js",new Date),gtag("config","AW-"+this.cid,{send_page_view:!1})}#r(i){if(i.tiktok&&"undefined"!=typeof ttq)for(var s=0;s<i.campaigns.length;s++)if("enh_conv_rem"===i.campaigns[s].name){ttq.track(i.campaigns[s].name);break}}refreshEventIdsOfCachedResult(i){let s=this,o=JSON.parse(i);return o.campaigns?(o.campaigns.forEach((i=>{if("Facebook"===i.adPlatform){const o="eid."+(Date.now().toString()+Math.floor(1e4*Math.random()).toString()).substring(5)+"."+s.vid;i={...i,eventId:o}}})),o):o}getCookie(i){for(var s=i+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var a=o[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(s))return a.substring(s.length,a.length)}return null}setCookie(i,s,o){var n="";if(o){var a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3),n="; expires="+a.toUTCString()}document.cookie=i+"="+(s||"")+n+"; path=/"}#e(){for(var i="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<10;o++)i+=s.charAt(Math.floor(62*Math.random()));return i}eraseCookie(i){document.cookie=i+"=; Max-Age=-99999999;"}getDeviceType(){const i=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(i)?"tablet":/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(i)?"mobile":"desktop"}#o(){if(console.log("scoreBasicUser lsr: ",this.lsr),this.lsr){let i=this.refreshEventIdsOfCachedResult(this.lsr);return this.#n(i,!1),void this.#a(i)}if(this.actions.l+4*this.actions.p+10*this.actions.c>=9){const i="eid."+(Date.now().toString()+Math.floor(1e4*Math.random()).toString()).substring(5)+"."+this.vid;this.#n({campaigns:[{name:"enh_conv_rem",adPlatform:"Facebook",eventId:i},{name:"enh_gdn_rem",adPlatform:"Google"}]},!0)}}async#t(){const i=localStorage.getItem("enh_info");if(this.getCookie("enh_info_exp")&&i){const s=JSON.parse(i);return this.isb=s.isBasicTracking??!1,this.isAnEnabled=s.isAnEnabled,this.categories=s.categories,this.country=s.country,this.cid=s.conversionId,this.actions=s.actions,this.isReady=!0,void this.#d()}const s="https://fncollect.enhencer.com/api/getaninfo?cid="+this.uid,o=await fetch(s,{method:"GET",headers:{"Content-Type":"text/plain"}});if(o.ok){const i=await o.json();return this.isb=i.isBasicTracking,this.isAnEnabled=i.isAnEnabled,this.categories=i.categories,this.country=i.country,this.cid=i.conversionId,this.actions={l:0,p:0,c:0},localStorage.setItem("enh_info",JSON.stringify({...i,actions:this.actions})),this.setCookie("enh_info_exp",1,7),this.isReady=!0,this.#d(),i}}#s(){const i={isBasicTracking:this.isb,isAnEnabled:this.isAnEnabled,categories:this.categories,country:this.country,conversionId:this.cid,actions:this.actions};localStorage.setItem("enh_info",JSON.stringify(i))}#i(i,s){if(!this.isReady){const o=Date.now(),n=setInterval((()=>this.isReady?(clearInterval(n),void this[i].apply(this,s)):Date.now()-o>=5e3?(clearInterval(n),void console.log(`Timeout: collector not ready after 5 seconds for ${i}`)):void 0),1e3);return!0}return!1}};if(void 0===window.enhencer){let i,s,o=document.currentScript.getAttribute("src");o=o.replace(/\r?\n|\r/,"").trim(),o.split("?")[1].split("&").forEach((s=>{s.includes("token")&&(i=s.substring(s.indexOf("token=")+6))})),window.enhencer=new EnhC(i,s),window.enhencer.init()}